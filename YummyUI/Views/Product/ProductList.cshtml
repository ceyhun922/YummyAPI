@using YummyUI.DTOs.ProductDTOs
@model List<ResultProductDto>

@{
  Layout = "_AdminLayout";
}

<style>
  /* ===== page scope ===== */
  .ai-products, .ai-products *{ box-sizing:border-box; }
  .ai-products{
    min-height:100%;
    padding: 1.7rem 2rem;
    position:relative;
    overflow:hidden;
    background:
      radial-gradient(1200px 600px at 70% 80%, rgba(56,189,248,.22), transparent 60%),
      radial-gradient(900px 500px at 15% 20%, rgba(139,92,246,.26), transparent 60%),
      radial-gradient(800px 420px at 90% 10%, rgba(99,102,241,.20), transparent 55%),
      linear-gradient(135deg,#070b1f 0%,#0a1030 40%,#050818 100%);
  }

  .grid-overlay{
    position:absolute; inset:0; pointer-events:none; opacity:.16;
    background-image:
      linear-gradient(rgba(255,255,255,0.06) 1px, transparent 1px),
      linear-gradient(90deg, rgba(255,255,255,0.06) 1px, transparent 1px);
    background-size: 64px 64px;
  }

  .orb{ position:absolute; border-radius:999px; filter:blur(95px); opacity:.55; pointer-events:none; }
  .orb.a{ width:520px;height:520px;left:-190px;top:-180px;background:rgba(139,92,246,.40); }
  .orb.b{ width:440px;height:440px;right:-200px;top:110px;background:rgba(56,189,248,.34); }
  .orb.c{ width:560px;height:560px;left:34%;bottom:-280px;background:rgba(99,102,241,.30); }

  .wrap{
    position:relative;
    z-index:5;
    max-width: 1600px;
    margin: 0 auto;
    display:flex;
    flex-direction:column;
    gap: 1.1rem;
  }

  /* ===== header ===== */
  .topbar{
    display:flex;
    align-items:center;
    justify-content:space-between;
    gap:1rem;
  }

  .h-left{
    display:flex;
    align-items:center;
    gap:.9rem;
  }

  .badge{
    width:52px;height:52px;
    border-radius:16px;
    display:grid;place-items:center;
    background:linear-gradient(135deg,#667eea,#764ba2);
    box-shadow:0 12px 35px rgba(102,126,234,.6);
    border:1px solid rgba(255,255,255,.12);
  }
  .badge span{ font-size:1.6rem; }

  .title{
    margin:0;
    font-size:2rem;
    font-weight:950;
    background:linear-gradient(135deg,#fff,#a8b9ff);
    -webkit-background-clip:text;
    -webkit-text-fill-color:transparent;
  }

  .subtitle{
    margin:.2rem 0 0 0;
    color:rgba(255,255,255,.65);
    font-weight:750;
    font-size:.95rem;
  }

  .add-btn{
    display:inline-flex;
    align-items:center;
    gap:.6rem;
    padding: 1rem 1.25rem;
    border-radius: 18px;
    font-weight: 950;
    text-decoration:none;
    color:#fff;
    border:1px solid rgba(255,255,255,.14);
    background: linear-gradient(135deg,#667eea,#764ba2);
    box-shadow: 0 14px 40px rgba(102,126,234,.55);
    transition: transform .45s cubic-bezier(.16,1,.3,1), box-shadow .45s ease, opacity .2s ease;
    white-space:nowrap;
  }
  .add-btn:hover{ transform: translateY(-2px); box-shadow: 0 18px 55px rgba(102,126,234,.75); }
  .add-btn:active{ transform: translateY(0); opacity:.96; }

  /* ===== command bar ===== */
  .command{
    background: rgba(15,23,42,.55);
    border-radius: 22px;
    border: 1px solid rgba(255,255,255,.12);
    backdrop-filter: blur(16px);
    box-shadow: 0 30px 70px rgba(0,0,0,.45);
    padding: 1rem 1rem;
    display:flex;
    align-items:center;
    justify-content:space-between;
    gap: 1rem;
    flex-wrap:wrap;
  }

  .search{
    flex: 1 1 360px;
    position:relative;
  }
  .search input{
    width:100%;
    padding: .95rem 1rem .95rem 2.75rem;
    border-radius: 16px;
    border:1px solid rgba(255,255,255,.14);
    background: rgba(255,255,255,.06);
    color:#fff;
    outline:none;
    transition: .45s cubic-bezier(.16,1,.3,1);
    font-weight: 750;
  }
  .search input:focus{
    border-color: rgba(102,126,234,.55);
    box-shadow: 0 0 0 4px rgba(102,126,234,.25);
    background: rgba(255,255,255,.08);
  }
  .search .ic{
    position:absolute;
    left: 1rem;
    top: 50%;
    transform: translateY(-50%);
    color: rgba(255,255,255,.65);
    font-weight: 900;
  }

  .filters{
    display:flex;
    gap:.6rem;
    flex-wrap:wrap;
    align-items:center;
    justify-content:flex-end;
  }

  .chip{
    border:1px solid rgba(255,255,255,.12);
    background: rgba(255,255,255,.06);
    color: rgba(255,255,255,.86);
    padding: .55rem .85rem;
    border-radius: 999px;
    font-weight: 900;
    cursor:pointer;
    transition: transform .15s ease, background .15s ease, border-color .15s ease;
    user-select:none;
    white-space:nowrap;
  }
  .chip:hover{ transform: translateY(-1px); background: rgba(255,255,255,.08); }
  .chip.active{
    background: linear-gradient(135deg,#667eea,#764ba2);
    border-color: rgba(255,255,255,.18);
    box-shadow: 0 16px 40px rgba(102,126,234,.35);
  }

  .meta{
    margin-left:auto;
    color: rgba(255,255,255,.7);
    font-weight: 850;
    font-size: .9rem;
    white-space:nowrap;
  }

  /* ===== grid ===== */
  .grid{
    display:grid;
    grid-template-columns: repeat(12, minmax(0, 1fr));
    gap: 1rem;
  }

  .p-card{
    grid-column: span 4;
    border-radius: 24px;
    border: 1px solid rgba(255,255,255,.12);
    background: rgba(15,23,42,.52);
    backdrop-filter: blur(16px);
    box-shadow: 0 35px 80px rgba(0,0,0,.45), inset 0 1px 0 rgba(255,255,255,.08);
    overflow:hidden;
    position:relative;
    transition: transform .55s cubic-bezier(.16,1,.3,1),
                box-shadow .55s ease,
                border-color .55s ease;
  }
  .p-card:hover{
    transform: translateY(-10px);
    border-color: rgba(102,126,234,.40);
    box-shadow: 0 50px 110px rgba(0,0,0,.55), 0 0 60px rgba(102,126,234,.12);
  }

  .p-media{
    height: 190px;
    position:relative;
    overflow:hidden;
    background: rgba(255,255,255,.05);
  }
  .p-media img{
    width:100%;
    height:100%;
    object-fit: cover;
    display:block;
    transform: scale(1.02);
    transition: transform .7s cubic-bezier(.16,1,.3,1), filter .5s ease;
    filter: saturate(1.02) contrast(1.02);
  }
  .p-card:hover .p-media img{ transform: scale(1.10); filter: saturate(1.12) contrast(1.05); }

  .noimg{
    width:100%;
    height:100%;
    display:flex;
    align-items:center;
    justify-content:center;
    flex-direction:column;
    gap:.35rem;
    color: rgba(255,255,255,.78);
    font-weight: 950;
  }
  .noimg small{ color: rgba(255,255,255,.55); font-weight: 750; }

  .p-body{
    padding: 1.05rem 1.1rem 1.15rem;
    display:flex;
    flex-direction:column;
    gap:.75rem;
  }

  .row1{
    display:flex;
    align-items:flex-start;
    justify-content:space-between;
    gap:.8rem;
  }

  .p-title{
    margin:0;
    color:#fff;
    font-weight: 950;
    font-size: 1.02rem;
    line-height:1.25;
    display:-webkit-box;
    -webkit-line-clamp:1;
    -webkit-box-orient:vertical;
    overflow:hidden;
  }

  .price{
    padding:.35rem .65rem;
    border-radius:999px;
    border:1px solid rgba(255,255,255,.12);
    background: rgba(255,255,255,.06);
    color: rgba(199,210,254,.95);
    font-weight: 950;
    font-size: .86rem;
    white-space:nowrap;
  }

  .desc{
    margin:0;
    color: rgba(255,255,255,.70);
    font-weight: 700;
    line-height:1.5;
    display:-webkit-box;
    -webkit-line-clamp:2;
    -webkit-box-orient:vertical;
    overflow:hidden;
    min-height: 3em;
  }

  .row2{
    display:flex;
    align-items:center;
    justify-content:space-between;
    gap:.8rem;
    flex-wrap:wrap;
  }

  .cat{
    display:inline-flex;
    align-items:center;
    padding:.45rem .75rem;
    border-radius:999px;
    font-weight: 900;
    font-size:.82rem;
    color: rgba(255,255,255,.88);
    background: rgba(255,255,255,.06);
    border:1px solid rgba(255,255,255,.10);
    white-space:nowrap;
  }

  .status-btn{
    border:none;
    padding:.55rem 1rem;
    border-radius:999px;
    font-weight: 950;
    font-size:.82rem;
    cursor:pointer;
    transition: transform .15s ease, opacity .15s ease;
    white-space:nowrap;
  }
  .status-btn:hover{ transform: translateY(-1px); }
  .st-on{
    background: linear-gradient(135deg,#f59e0b,#f97316);
    color:#1a1a1a;
    box-shadow: 0 14px 35px rgba(245,158,11,.25);
  }
  .st-off{
    background: linear-gradient(135deg,#22c55e,#16a34a);
    color:#052e16;
    box-shadow: 0 14px 35px rgba(34,197,94,.20);
  }

  .actions{
    display:flex;
    gap:.55rem;
    flex-wrap:wrap;
    margin-top:.1rem;
  }

  .btn-mini{
    padding: .72rem .95rem;
    border-radius: 14px;
    font-weight: 950;
    font-size: .86rem;
    border: 1px solid rgba(255,255,255,.14);
    text-decoration:none;
    display:inline-flex;
    align-items:center;
    gap:.45rem;
    transition: .15s;
    cursor:pointer;
    white-space:nowrap;
  }
  .btn-mini:hover{ transform: translateY(-2px); }

  .btn-mini.warn{
    background: linear-gradient(135deg,#fbbf24,#f59e0b);
    color:#1a1a1a;
    box-shadow: 0 14px 40px rgba(245,158,11,.18);
  }
  .btn-mini.dang{
    background: linear-gradient(135deg,#ef4444,#dc2626);
    color:#fff;
    box-shadow: 0 14px 40px rgba(239,68,68,.22);
  }

  .empty{
    background: rgba(15,23,42,.55);
    border-radius: 28px;
    border: 1px solid rgba(255,255,255,.12);
    backdrop-filter: blur(16px);
    box-shadow: 0 40px 80px rgba(0,0,0,.45);
    padding: 2.2rem;
    text-align:center;
    color: rgba(255,255,255,.78);
  }
  .empty h2{ margin:0 0 .45rem 0; color:#fff; font-weight:950; }
  .empty p{ margin:0 0 1.1rem 0; color: rgba(255,255,255,.68); }

  @@media (max-width: 1200px){
    .p-card{ grid-column: span 6; }
  }
  @@media (max-width: 700px){
    .ai-products{ padding: 1.2rem; }
    .title{ font-size: 1.6rem; }
    .p-card{ grid-column: span 12; }
  }
</style>

<div class="ai-products">
  <div class="orb a"></div>
  <div class="orb b"></div>
  <div class="orb c"></div>
  <div class="grid-overlay"></div>

  <div class="wrap">

    <div class="topbar">
      <div class="h-left">
        <div class="badge"><span>üõçÔ∏è</span></div>
        <div>
          <h1 class="title">√úr√ºnler</h1>
          <div class="subtitle">AI premium √ºr√ºn panosu ‚Ä¢ hƒ±zlƒ± filtrele ‚Ä¢ hƒ±zlƒ± y√∂net</div>
        </div>
      </div>

      <a asp-action="CreateProduct" asp-controller="Product" class="add-btn">‚ûï Yeni √úr√ºn Giri≈üi</a>
    </div>

    <div class="command">
      <div class="search">
        <span class="ic">üîé</span>
        <input id="pSearch" type="text" placeholder="√úr√ºn adƒ± / a√ßƒ±klama / kategori ara..." />
      </div>

      <div class="filters" id="catFilters">
        <span class="chip active" data-cat="__all">T√ºm√º</span>
        @* Kategorileri Model i√ßinden otomatik basƒ±yoruz *@
        @{
          var cats = (Model ?? new List<ResultProductDto>())
            .Select(x => x.CategoryName ?? "")
            .Where(x => !string.IsNullOrWhiteSpace(x))
            .Distinct()
            .OrderBy(x => x)
            .ToList();
        }
        @foreach (var c in cats)
        {
          <span class="chip" data-cat="@c">@c</span>
        }
      </div>

      <div class="meta">
        Toplam: <span id="pCount">@(Model?.Count ?? 0)</span>
      </div>
    </div>

    @if (Model != null && Model.Any())
    {
      <div class="grid" id="pGrid">
        @foreach (var product in Model)
        {
          var img = product.ProductImageUrl;
          var cat = product.CategoryName ?? "";
          var title = product.ProductTitle ?? "√úr√ºn";
          var desc = product.ProductDescription ?? "";
          var priceText = product.ProductPrice.ToString(new System.Globalization.CultureInfo("tr-TR"));

          <div class="p-card"
               data-title="@title.ToLowerInvariant()"
               data-desc="@desc.ToLowerInvariant()"
               data-cat="@cat"
               data-cat-l="@cat.ToLowerInvariant()">
            <div class="p-media">
              @if (!string.IsNullOrWhiteSpace(img))
              {
                <img src="@img"
                     alt="@title"
                     loading="lazy"
                     onerror="this.onerror=null;this.parentElement.innerHTML='<div class=&quot;noimg&quot;><div style=&quot;font-size:1.4rem;&quot;>üì∑</div>No Img<small>G√∂rsel yok</small></div>';" />
              }
              else
              {
                <div class="noimg">
                  <div style="font-size:1.4rem;">üì∑</div>
                  No Img
                  <small>G√∂rsel yok</small>
                </div>
              }
            </div>

            <div class="p-body">
              <div class="row1">
                <p class="p-title">@title</p>
                <span class="price">@priceText</span>
              </div>

              <p class="desc">@desc</p>

              <div class="row2">
                <span class="cat">@cat</span>

                <button type="button"
                        class="status-btn @(product.ProductStatus ? "st-on" : "st-off")"
                        data-url="@Url.Action("ChangeCategoryStatus", "Admin", new { id = product.ProductId })"
                        data-status="@product.ProductStatus">
                  @(product.ProductStatus ? "Pasif Et" : "Aktif Et")
                </button>
              </div>

              <div class="actions">
                <a asp-action="ProductUpdate"
                   asp-controller="Product"
                   asp-route-id="@product.ProductId"
                   class="btn-mini warn">‚úèÔ∏è G√ºncelle</a>

                <a asp-action="ProductDelete"
                   asp-controller="Product"
                   asp-route-id="@product.ProductId"
                   class="btn-mini dang">üóëÔ∏è Sil</a>
              </div>
            </div>
          </div>
        }
      </div>
    }
    else
    {
      <div class="empty">
        <h2>Hen√ºz √ºr√ºn yok</h2>
        <p>ƒ∞lk √ºr√ºn√º eklemek i√ßin ‚ÄúYeni √úr√ºn Giri≈üi‚Äù butonuna tƒ±kla.</p>
        <a asp-action="CreateProduct" asp-controller="Product" class="add-btn">‚ûï Yeni √úr√ºn Giri≈üi</a>
      </div>
    }

  </div>
</div>

<script>
(function(){
  const search = document.getElementById("pSearch");
  const grid = document.getElementById("pGrid");
  const countEl = document.getElementById("pCount");
  const filters = document.getElementById("catFilters");

  if (!grid) return;

  let activeCat = "__all";

  function apply(){
    const q = (search?.value || "").trim().toLowerCase();
    const cards = Array.from(grid.querySelectorAll(".p-card"));
    let visible = 0;

    cards.forEach(card=>{
      const t = card.getAttribute("data-title") || "";
      const d = card.getAttribute("data-desc") || "";
      const catL = card.getAttribute("data-cat-l") || "";
      const cat = card.getAttribute("data-cat") || "";

      const matchQ = !q || t.includes(q) || d.includes(q) || catL.includes(q);
      const matchCat = (activeCat === "__all") || (cat === activeCat);

      const show = matchQ && matchCat;
      card.style.display = show ? "" : "none";
      if(show) visible++;
    });

    if (countEl) countEl.textContent = String(visible);
  }

  search?.addEventListener("input", apply);

  filters?.addEventListener("click", (e)=>{
    const chip = e.target.closest(".chip");
    if(!chip) return;

    activeCat = chip.getAttribute("data-cat") || "__all";

    Array.from(filters.querySelectorAll(".chip")).forEach(x=>x.classList.remove("active"));
    chip.classList.add("active");

    apply();
  });

  apply();
})();
</script>
