@{
  Layout = "~/Views/Shared/_AdminLayout.cshtml";
}
<P>Index</P>
<div class="row ">
  <!-- Bugünkü Organizasyon -->
  <div class="col-xl-3 col-lg-6 col-md-6 col-sm-6 col-xs-12">
    <div class="card">
      <div class="card-statistic-4">
        <div class="align-items-center justify-content-between">
          <div class="row ">
            <div class="col-lg-6 col-md-6 col-sm-6 col-xs-6 pr-0 pt-3">
              <div class="card-content">
                <h5 class="font-15">Bugünkü Organizasyon</h5>
                <h2 class="mb-3 font-18">4</h2>
                <p class="mb-0"><span class="col-green">+1</span> dünden fazla</p>
              </div>
            </div>
            <div class="col-lg-6 col-md-6 col-sm-6 col-xs-6 pl-0">
              <div class="banner-img">
                <img src="/Admin/assets/img/banner/1.png" alt="">
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>
  </div>

  <!-- Aktif Grup -->
  <div class="col-xl-3 col-lg-6 col-md-6 col-sm-6 col-xs-12">
    <div class="card">
      <div class="card-statistic-4">
        <div class="align-items-center justify-content-between">
          <div class="row ">
            <div class="col-lg-6 col-md-6 col-sm-6 col-xs-6 pr-0 pt-3">
              <div class="card-content">
                <h5 class="font-15">Aktif Grup</h5>
                <h2 class="mb-3 font-18">7</h2>
                <p class="mb-0"><span class="col-green">Stabil</span></p>
              </div>
            </div>
            <div class="col-lg-6 col-md-6 col-sm-6 col-xs-6 pl-0">
              <div class="banner-img">
                <img src="/Admin/assets/img/banner/2.png" alt="">
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>
  </div>

  <!-- Okunmamış Mesaj -->
  <div class="col-xl-3 col-lg-6 col-md-6 col-sm-6 col-xs-12">
    <div class="card">
      <div class="card-statistic-4">
        <div class="align-items-center justify-content-between">
          <div class="row ">
            <div class="col-lg-6 col-md-6 col-sm-6 col-xs-6 pr-0 pt-3">
              <div class="card-content">
                <h5 class="font-15">Okunmamış Mesaj</h5>
                <h2 class="mb-3 font-18">3</h2>
                <p class="mb-0"><span class="col-orange">Dikkat</span> bekliyor</p>
              </div>
            </div>
            <div class="col-lg-6 col-md-6 col-sm-6 col-xs-6 pl-0">
              <div class="banner-img">
                <img src="/Admin/assets/img/banner/3.png" alt="">
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>
  </div>

  <!-- Bugün Oluşturulan -->
  <div class="col-xl-3 col-lg-6 col-md-6 col-sm-6 col-xs-12">
    <div class="card">
      <div class="card-statistic-4">
        <div class="align-items-center justify-content-between">
          <div class="row ">
            <div class="col-lg-6 col-md-6 col-sm-6 col-xs-6 pr-0 pt-3">
              <div class="card-content">
                <h5 class="font-15">Bugün Oluşturulan</h5>
                <h2 class="mb-3 font-18">2</h2>
                <p class="mb-0"><span class="col-green">Yeni</span> kayıt</p>
              </div>
            </div>
            <div class="col-lg-6 col-md-6 col-sm-6 col-xs-6 pl-0">
              <div class="banner-img">
                <img src="/Admin/assets/img/banner/4.png" alt="">
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>
  </div>
</div>

@await Component.InvokeAsync("_ApexChartComponentPartilas")


@await Component.InvokeAsync("_GroupOrganizationComponentPartials")


<div class="row">
  <div class="col-md-6 col-lg-12 col-xl-6">
    <!-- Support tickets -->
@await Component.InvokeAsync("_DailyWordChickenMenuPartials")
    <!-- Support tickets -->
  </div>
<div class="col-md-6 col-lg-12 col-xl-6">
  <div class="card">
    <div class="card-header">
      <h4>Sistem Özeti</h4>
    </div>

    <div class="card-body">
      <!-- KPI Cards -->
      <div class="row">
        <div class="col-6 mb-3">
          <div class="card mb-0">
            <div class="card-body py-3">
              <div class="d-flex align-items-center justify-content-between">
                <div>
                  <div class="text-muted">Toplam Organizasyon</div>
                  <div class="h4 mb-0">128</div>
                </div>
                <span class="badge badge-light">All</span>
              </div>
            </div>
          </div>
        </div>

        <div class="col-6 mb-3">
          <div class="card mb-0">
            <div class="card-body py-3">
              <div class="d-flex align-items-center justify-content-between">
                <div>
                  <div class="text-muted">Toplam Şef</div>
                  <div class="h4 mb-0">24</div>
                </div>
                <span class="badge badge-info">Chef</span>
              </div>
            </div>
          </div>
        </div>

        <div class="col-6 mb-3">
          <div class="card mb-0">
            <div class="card-body py-3">
              <div class="d-flex align-items-center justify-content-between">
                <div>
                  <div class="text-muted">Toplam Galeri</div>
                  <div class="h4 mb-0">312</div>
                </div>
                <span class="badge badge-success">Gallery</span>
              </div>
            </div>
          </div>
        </div>

        <div class="col-6 mb-3">
          <div class="card mb-0">
            <div class="card-body py-3">
              <div class="d-flex align-items-center justify-content-between">
                <div>
                  <div class="text-muted">Toplam Mesaj</div>
                  <div class="h4 mb-0">54</div>
                </div>
                <span class="badge badge-warning">Inbox</span>
              </div>
            </div>
          </div>
        </div>
      </div>

      <hr class="my-3" />

      <!-- Mini List -->
      <div class="mb-2 font-weight-bold">Aylık Özet</div>
      <ul class="list-unstyled mb-0">
        <li class="d-flex justify-content-between py-2 border-bottom">
          <span class="text-muted">Bu ay oluşturulan organizasyon</span>
          <span class="font-weight-bold">18</span>
        </li>
        <li class="d-flex justify-content-between py-2 border-bottom">
          <span class="text-muted">Bu hafta gelen mesaj</span>
          <span class="font-weight-bold">7</span>
        </li>
        <li class="d-flex justify-content-between py-2">
          <span class="text-muted">Trash'teki toplam mesaj</span>
          <span class="font-weight-bold">12</span>
        </li>
      </ul>
    </div>
  </div>
</div>





</div>

<div class="settingSidebar">
  <a href="javascript:void(0)" class="settingPanelToggle"> <i class="fa fa-spin fa-cog"></i>
  </a>
  <div class="settingSidebar-body ps-container ps-theme-default">
    <div class=" fade show active">
      <div class="setting-panel-header">Setting Panel
      </div>
      <div class="p-15 border-bottom">
        <h6 class="font-medium m-b-10">Select Layout</h6>
        <div class="selectgroup layout-color w-50">
          <label class="selectgroup-item">
            <input type="radio" name="value" value="1" class="selectgroup-input-radio select-layout" checked>
            <span class="selectgroup-button">Light</span>
          </label>
          <label class="selectgroup-item">
            <input type="radio" name="value" value="2" class="selectgroup-input-radio select-layout">
            <span class="selectgroup-button">Dark</span>
          </label>
        </div>
      </div>
      <div class="p-15 border-bottom">
        <h6 class="font-medium m-b-10">Sidebar Color</h6>
        <div class="selectgroup selectgroup-pills sidebar-color">
          <label class="selectgroup-item">
            <input type="radio" name="icon-input" value="1" class="selectgroup-input select-sidebar">
            <span class="selectgroup-button selectgroup-button-icon" data-toggle="tooltip"
              data-original-title="Light Sidebar"><i class="fas fa-sun"></i></span>
          </label>
          <label class="selectgroup-item">
            <input type="radio" name="icon-input" value="2" class="selectgroup-input select-sidebar" checked>
            <span class="selectgroup-button selectgroup-button-icon" data-toggle="tooltip"
              data-original-title="Dark Sidebar"><i class="fas fa-moon"></i></span>
          </label>
        </div>
      </div>
      <div class="p-15 border-bottom">
        <h6 class="font-medium m-b-10">Color Theme</h6>
        <div class="theme-setting-options">
          <ul class="choose-theme list-unstyled mb-0">
            <li title="white" class="active">
              <div class="white"></div>
            </li>
            <li title="cyan">
              <div class="cyan"></div>
            </li>
            <li title="black">
              <div class="black"></div>
            </li>
            <li title="purple">
              <div class="purple"></div>
            </li>
            <li title="orange">
              <div class="orange"></div>
            </li>
            <li title="green">
              <div class="green"></div>
            </li>
            <li title="red">
              <div class="red"></div>
            </li>
          </ul>
        </div>
      </div>
      <div class="p-15 border-bottom">
        <div class="theme-setting-options">
          <label class="m-b-0">
            <input type="checkbox" name="custom-switch-checkbox" class="custom-switch-input" id="mini_sidebar_setting">
            <span class="custom-switch-indicator"></span>
            <span class="control-label p-l-10">Mini Sidebar</span>
          </label>
        </div>
      </div>
      <div class="p-15 border-bottom">
        <div class="theme-setting-options">
          <label class="m-b-0">
            <input type="checkbox" name="custom-switch-checkbox" class="custom-switch-input" id="sticky_header_setting">
            <span class="custom-switch-indicator"></span>
            <span class="control-label p-l-10">Sticky Header</span>
          </label>
        </div>
      </div>
      <div class="mt-4 mb-4 p-3 align-center rt-sidebar-last-ele">
        <a href="#" class="btn btn-icon icon-left btn-primary btn-restore-theme">
          <i class="fas fa-undo"></i> Restore Default
        </a>
      </div>
    </div>
  </div>
</div>



@section Scripts
{
  <script>
  // ========= helpers =========
  function money(n) {
    const x = Number(n || 0);
    return  x.toLocaleString(undefined, { maximumFractionDigits: 0 }) + "" + "TL" ;
  }
  function pct(n) {
    const x = Number(n || 0);
    const sign = x >= 0 ? "+" : "";
    return sign + x.toFixed(0) + "%";
  }

  // ========= chart =========
  let revChart = null;

  function initChart(labels, revenue, reservations) {
    const options = {
      chart: { type: "line", height: 340, toolbar: { show: false } },
      stroke: { curve: "smooth", width: 4 },
      markers: { size: 6 },
      dataLabels: { enabled: false },
      xaxis: { categories: labels },
      series: [
        { name: "Revenue", data: revenue },
        { name: "Reservations", data: reservations }
      ],
      tooltip: {
        y: [
          { formatter: (v) => money(v) },
          { formatter: (v) => (v ?? 0) + " rez." }
        ]
      }
    };

    revChart = new ApexCharts(document.querySelector("#chart1"), options);
    revChart.render();
  }

  function updateChart(labels, revenue, reservations) {
    if (!revChart) return initChart(labels, revenue, reservations);

    revChart.updateOptions({ xaxis: { categories: labels } });
    revChart.updateSeries([
      { name: "Revenue", data: revenue },
      { name: "Reservations", data: reservations }
    ]);
  }

  // ========= UI fill =========
  function setText(id, val) {
    const el = document.getElementById(id);
    if (el) el.textContent = val;
  }

  function setPctSup(id, val, positiveClass, negativeClass) {
    const el = document.getElementById(id);
    if (!el) return;
    el.textContent = pct(val);

    el.classList.remove("col-green", "text-danger");
    if (val >= 0) el.classList.add(positiveClass || "col-green");
    else el.classList.add(negativeClass || "text-danger");
  }

  // ========= load =========
  async function loadRevenueDashboard() {

    const res = await fetch("/Admin/Revenue", { method: "GET" });

    const text = await res.text();

    if (!res.ok) {
      console.error("Dashboard HTTP:", res.status, text);
      return;
    }

    const data = JSON.parse(text);

    // chart
    updateChart(data.labels || [], data.revenue || [], data.reservations || []);

    // KPI (weekly/monthly/yearly)
    setText("kpiWeekly", money(data.weeklyEarnings));
    setText("kpiMonthly", money(data.monthlyEarnings));
    setText("kpiYearly", money(data.yearlyEarnings));

    // right stats
    setText("stCustomers", (data.totalCustomers ?? 0).toLocaleString());
    setText("stIncome", money(data.totalIncome));
    setText("stProjects", (data.projectCompleted ?? 0).toLocaleString());
    setText("stExpense", money(data.totalExpense));
    setText("stNewCustomers", (data.newCustomers ?? 0).toLocaleString());

    // percent alanları: backend göndermiyorsa demo 0 gösterir
    // İstersen API'ye bu alanları ekleriz: customersPct, incomePct, projectsPct, expensePct, newCustomersPct
    setPctSup("stCustomersPct", data.customersPct ?? 0, "col-green", "text-danger");
    setPctSup("stIncomePct", data.incomePct ?? 0, "col-green", "text-danger");
    setPctSup("stProjectsPct", data.projectsPct ?? 0, "col-green", "text-danger");
    setPctSup("stExpensePct", data.expensePct ?? 0, "col-green", "text-danger");
    setPctSup("stNewCustomersPct", data.newCustomersPct ?? 0, "col-green", "text-danger");

    // feather icons refresh
    if (window.feather) feather.replace();
  }

  // Options -> refresh
  document.addEventListener("click", (e) => {
    const a = e.target.closest(".dropdown-item");
    if (!a) return;
    if (a.textContent.toLowerCase().includes("refresh")) {
      e.preventDefault();
      loadRevenueDashboard();
    }
  });

  // first load
  loadRevenueDashboard();
</script>
}